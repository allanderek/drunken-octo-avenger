// Generated by CoffeeScript 1.9.0
(function() {
  module('Persona');

  test('init function sets request and logout callbacks', function() {
    var logout_called, mock_navigator, request_called, watch_called;
    request_called = false;
    logout_called = false;
    watch_called = false;
    mock_navigator = {
      id: {
        logout: function() {
          return logout_called = true;
        },
        request: function() {
          return request_called = true;
        },
        watch: function(params) {
          var p_user, t_user;
          p_user = params.loggedInUser;
          t_user = tesuji_charm.current_persona_email;
          ok((t_user === '' && p_user === null) || (t_user !== '' && p_user === t_user), 'navigator.id.watch passed good loggedInUser');
          ok(typeof params.onlogin === 'function', 'navigator.id.watch passed function for onlogin');
          ok(typeof params.onlogout === 'function', 'navigator.id.watch passed function for onlogout');
          return watch_called = true;
        }
      }
    };
    equal(watch_called, false);
    tesuji_charm.current_persona_email = '';
    tesuji_charm.persona.initialize(mock_navigator);
    equal(watch_called, true, 'navigator.id.watch called');
    tesuji_charm.current_persona_email = 'bob@example.com';
    tesuji_charm.persona.initialize(mock_navigator);
    equal(request_called, false);
    equal(logout_called, false);
    $('#persona_login').click();
    equal(request_called, true, 'login request called correctly');
    equal(logout_called, false);
    $('#logout').click();
    return equal(logout_called, true, 'logout callback called correctly');
  });

  module('Basic game page', {
    setup: function() {
      tesuji_charm.game_no = 42;
      tesuji_charm.move_no = 0;
      tesuji_charm.game_url = '/game';
      return tesuji_charm.game_basic.initialize();
    }
  });

  test('clicking multiple points moves black stone', function() {
    var $img1, $img2, $point1, $point2;
    $point1 = $('table.goban td').first();
    $img1 = $point1.find('img').first();
    $point2 = $point1.next();
    $img2 = $point2.find('img').first();
    ok($img1.attr('src').indexOf('e.gif') > -1, 'first point is initially empty (e.gif)');
    $point1.click();
    ok($img1.attr('src').indexOf('e.gif') === -1, 'after click, no longer empty');
    ok($img1.attr('src').indexOf('b.gif') > -1, 'after click, contains b.gif');
    $point2.click();
    ok($img1.attr('src').indexOf('e.gif') > -1, 'after second click, first clicked point clear');
    return ok($img2.attr('src').indexOf('b.gif') > -1, 'after second click, second clicked point black');
  });

  test('Confirm button disabled until stone placed', function() {
    var $button;
    $button = $('button.confirm_button');
    equal($button.prop('disabled'), true, 'starts out disabled');
    $('table.goban td').first().click();
    return equal($button.prop('disabled'), false, 'enabled after stone placed');
  });

  test('Confirm button sends request with new move', function() {
    var call_params, data, original_get;
    original_get = $.get;
    call_params = null;
    $.get = function(url, data) {
      return call_params = {
        url: url,
        data: data
      };
    };
    $('table.goban td').first().click();
    $('table.goban td').first().next().click();
    $('button.confirm_button').first().click();
    ok(call_params !== null, 'ajax request sent');
    data = call_params.data;
    equal(data.game_no, tesuji_charm.game_no, 'game no in request data');
    equal(data.move_no, tesuji_charm.move_no, 'move no in request data');
    equal(data.row, 0, 'row no in request data');
    equal(data.column, 1, 'column no in request data');
    return $.get = original_get;
  });

}).call(this);
