// Generated by CoffeeScript 1.9.1
(function() {
  casper.test.begin('Test the login procedure', 2, function(test) {
    var check_no_popups;
    casper.start('http://localhost:5000', function() {
      return test.assertTitle('Go', 'The front page title is the one expected');
    });
    check_no_popups = function() {
      return casper.popups.length === 0;
    };
    casper.echo(casper.popups.length);
    casper.thenClick('#persona_login');
    casper.waitForPopup(/persona/);
    casper.withPopup(/persona/, function() {
      var first_popup;
      test.assertTitleMatch(/Persona/i, 'Persona login popup has expected title');
      this.sendKeys('#authentication_email', 'test@mockmyid.com');
      test.assertExists('button:enabled');
      this.echo(casper.popups.length);
      this.thenClick('button:enabled');
      this.echo(casper.popups.length);
      first_popup = casper.popups[0];
      this.echo(first_popup.content);
      this.echo(first_popup.plainText);
      this.thenClick('button:enabled');
      this.echo(casper.popups.length);
      this.capture('log.png');
      test.assertExists('.continue:enabled');
      this.thenClick('.continue:enabled');
      return this.capture('log2.png');
    });
    casper.then(function() {
      this.echo("I am the roomba queen.");
      this.echo(casper.popups.length);
      return test.assertExists('#logout');
    });
    return casper.run(function() {
      return test.done();
    });
  });

}).call(this);
