<!DOCTYPE html>
<html>
<head>
<link href="/static/index.css" rel="stylesheet" type="text/css">
<!-- following meta is needed by Persona -->
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>Go</title>
</head>
<body>
{% if current_user_email %}
<div class="logged_in_user">Logged in as: {{ current_user_email }}</div>
{% if current_persona_email %}
<a href="#" id="logout">Log out</a>
{% else %}  <!-- else current_persona_email -->
<a href="/logout" id="logout">Log out</a>
{% endif %}  <!-- end current_persona_email -->
{% else %}  <!-- else current_user_email -->
<a href="#" id="persona_login">Login with Persona</a>
<form id="login_form"
      action="{{ url_for('login') }}" method="POST">
    {{ login_form.hidden_tag() }}
    {{ login_form.username.label }} {{ login_form.username(size=30) }}
    {{ login_form.password.label }} {{ login_form.password(size=30) }}
    <input id="login_submit" type="submit" name="login" value="Login" \>
</form>
<a id="new_account" href="{{ url_for('create_account') }}">
    Create a new account
</a>
{% endif %}

{% if current_user_email %}
<div id="main_menu">
    <ul>
        <li><a href="{{ url_for('status') }}">Status</a></li>
        <li><a href="{{ url_for('challenge') }}" id='challenge_link'>Challenge a player</a></li>
    </ul>
</div>
{% endif %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% block content %}
{% endblock %}

<script>
window.tesuji_charm = {
    currentUserEmail: "{{ current_user_email }}",
    currentPersonaEmail: "{{ current_persona_email }}",
};
</script>
<script src="/static/jquery.js"></script>
<script src="https://login.persona.org/include.js"></script>
<script src="/static/compiled-js/persona.js"></script>
<script>
tesuji_charm.persona.initialize(navigator);
</script>
{% block page_scripts %}
{% endblock %}
</body>
</html>
